---
- name: Set variables for this iteration of the loop.
  set_fact:
    manifest_directory: "{{ k8s_manifests_base_dir }}{{ outer_item.dir | default(outer_item) }}"
    manifest_directory_rel: "{{ outer_item.dir | default(outer_item) }}"
    manifest_lookup_type: "{{ outer_item.lookup_type | default('fileglob') }}"
    manifest_namespace: "{{ outer_item.namespace | default('') }}"

- name: Include vars specific to this manifest.
  include_vars: "{{ item }}"
  with_first_found:
    - files:
        - "{{ manifest_directory }}/vars.yml"
      skip: true

- name: res
  debug: msg="{{ item }}"
  loop: "{{ lookup(manifest_lookup_type, manifest_directory + '/manifest.yml', wantlist=True) }}"

- name: Deploy k3s manifests defined in manifests.
  include_tasks: deploy-k3s-manifest.yml
  when: not use_k8s

- name: Deploy k8s manifests defined in manifests.
  include_tasks: deploy-k8s-manifest.yml
  when: use_k8s
  